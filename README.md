# ONNXMalwareDetection
TF2 to ML.NET

## Onnx model consumed by ML.NET
## Data sources:
[kaggle](https://www.kaggle.com/competitions/malware-detection/data)
## Target
- labels denoting positive, negative class 

## Production:
- Tensorflow NN (2 inputs - cat/num)
- 10 epochs, val_accuracy: 0.9855
- preprocessing - enc.pkl simple encoding of icat
- converted to Onnx format

## Setup dotnet
```sh
dotnet new console -o <Project Name>
cd <Project Name>
dotnet add package Microsoft.ML
dotnet add package Microsoft.ML.OnnxRuntime
dotnet add package Microsoft.ML.OnnxTransformer

```
## Artifacts
Adding the artefact to the root of the project
Adding to <Project>.cproj

```sh
<ItemGroup>
    <None Include="model.onnx">
        <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
</ItemGroup>
```
## Compile and run
```sh
dotnet run '{"Hard": [224, 8462, 7, 10, 0, 4096, 4096, 512, 5, 2, 5, 2, 4, 0, 1024, 2, 1024, 262144, 4096, 1048576, 4096, 0, 16, 3, 2, 0, 1, 0, 0],"Soft": [1536.0, 1536.0, 4200.0, 8192.0, 1612185600.0, 16384.0, 33300.0, 2.78506345371, 0.446642116778, 4.54209516232, 1024.0, 512.0, 1536.0, 716.666666667, 62.0, 1080.0, 7.0, 1.0, 3.54378658001, 3.54378658001, 3.54378658001, 912.0, 912.0, 912.0]}'
```

## Publish
```sh
dotnet publish -r linux-x64 --self-contained true
```
## Trial with json example
```sh
dotnet <path to dll>/KASP/bin/Debug/net6.0/linux-x64/KASP.dll '{"Hard": [224, 271, 7, 26, 164864, 4096, 4096, 512, 4, 0, 0, 0, 4, 0, 1024, 2, 0, 1048576, 4096, 1048576, 4096, 0, 16, 4, 3, 0, 0, 0, 0],"Soft": [0.0, 22528.0, 196754.0, 4096.0, 4194304.0, 201163.0, 0.0, 4.71170934102, 0.0, 7.91443689974, 6016.0, 0.0, 22528.0, 47485.5, 459.0, 166514.0, 11.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}'

```





